<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة X O المتطورة</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .main-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
            justify-content: center;
        }
        
        .ad-container {
            flex: 0 0 160px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .ad-banner {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .ad-banner h3 {
            margin-bottom: 10px;
            color: #ffeb3b;
        }
        
        .ad-placeholder {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .game-container {
            flex: 1;
            max-width: 600px;
            text-align: center;
            z-index: 10;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .setup-screen {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .setup-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #ffeb3b;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: right;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .players-inputs {
            display: flex;
            gap: 15px;
        }
        
        .players-inputs .input-group {
            flex: 1;
        }
        
        .start-btn {
            background: #ffeb3b;
            color: #2575fc;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-top: 10px;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: #fff;
        }
        
        .game-screen {
            display: none;
        }
        
        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .player-score {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .score {
            font-size: 2rem;
            margin-top: 5px;
        }
        
        .game-board {
            display: grid;
            grid-gap: 8px;
            margin: 20px auto;
            position: relative;
        }
        
        .cell {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
            aspect-ratio: 1;
        }
        
        .cell:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .cell.x {
            color: #ff4757;
        }
        
        .cell.o {
            color: #2ed573;
        }
        
        .status {
            font-size: 1.5rem;
            margin: 20px 0;
            min-height: 40px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background: white;
            color: #2575fc;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .winner-cell {
            animation: pulse 0.8s infinite, glow 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.7); }
            50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.9), 0 0 30px rgba(255, 215, 0, 0.6); }
            100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.7); }
        }
        
        .win-message {
            animation: bounce 0.8s, colorChange 2s infinite;
            font-size: 2rem;
            margin: 20px 0;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        @keyframes colorChange {
            0% { color: #ff4757; }
            25% { color: #ffa502; }
            50% { color: #2ed573; }
            75% { color: #1e90ff; }
            100% { color: #ff4757; }
        }
        
        .win-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, #ffeb3b, transparent);
            height: 8px;
            border-radius: 4px;
            z-index: 1;
            opacity: 0;
            box-shadow: 0 0 10px #ffeb3b, 0 0 20px #ffeb3b;
            animation: lineAppear 0.5s forwards, lineMove 2s infinite;
        }
        
        @keyframes lineAppear {
            to { opacity: 1; }
        }
        
        @keyframes lineMove {
            0% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            100% { transform: translateX(-10px); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0.8;
            border-radius: 50%;
            z-index: 1;
        }
        
        .ad-note {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }
        
        @media (max-width: 1024px) {
            .ad-container {
                flex: 0 0 120px;
            }
            
            .ad-banner {
                min-height: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }
            
            .ad-container {
                flex-direction: row;
                flex: 0 0 auto;
                width: 100%;
                max-width: 600px;
                justify-content: space-between;
            }
            
            .ad-banner {
                min-height: 120px;
                flex: 1;
                margin: 0 10px;
            }
            
            .game-container {
                order: -1;
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .cell {
                font-size: 1.5rem;
            }
            
            button {
                padding: 10px 20px;
            }
            
            .players-inputs {
                flex-direction: column;
                gap: 10px;
            }
            
            .ad-container {
                flex-direction: column;
            }
            
            .ad-banner {
                min-height: 100px;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>لعبة X O المتطورة</h1>
        <p class="subtitle">اللعبة الشهيرة تيك تاك تو مع إمكانيات متقدمة</p>
    </div>
    
    <div class="main-container">
        <!-- البنر الأيسر للإعلانات -->
        <div class="ad-container">
            <div class="ad-banner">
                <h3>إعلان</h3>
                <!-- إعلان جوجل أدسنس - بنر عمودي -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <div class="ad-note">إعلان - دعماً للموقع</div>
            </div>
            <div class="ad-banner">
                <h3>إعلان</h3>
                <!-- إعلان جوجل أدسنس - بنر مربع -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <div class="ad-note">إعلان - دعماً للموقع</div>
            </div>
        </div>
        
        <!-- منطقة اللعبة الرئيسية -->
        <div class="game-container">
            <div class="setup-screen" id="setupScreen">
                <div class="setup-title">إعدادات اللعبة</div>
                
                <div class="players-inputs">
                    <div class="input-group">
                        <label for="playerX">اسم اللاعب X</label>
                        <input type="text" id="playerX" placeholder="أدخل اسم اللاعب X" value="لاعب X">
                    </div>
                    
                    <div class="input-group">
                        <label for="playerO">اسم اللاعب O</label>
                        <input type="text" id="playerO" placeholder="أدخل اسم اللاعب O" value="لاعب O">
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="boardSize">حجم اللوحة</label>
                    <select id="boardSize">
                        <option value="3">3x3 (كلاسيكي)</option>
                        <option value="4">4x4 (متوسط)</option>
                        <option value="5">5x5 (متقدم)</option>
                    </select>
                </div>
                
                <button class="start-btn" id="startBtn">ابدأ اللعبة</button>
            </div>
            
            <div class="game-screen" id="gameScreen">
                <div class="score-board">
                    <div class="player-score">
                        <div class="player-name" id="playerXName">لاعب X</div>
                        <div class="score" id="scoreX">0</div>
                    </div>
                    <div class="player-score">
                        <div class="player-name">تعادل</div>
                        <div class="score" id="scoreTie">0</div>
                    </div>
                    <div class="player-score">
                        <div class="player-name" id="playerOName">لاعب O</div>
                        <div class="score" id="scoreO">0</div>
                    </div>
                </div>
                
                <div class="status" id="status">دور: لاعب X</div>
                
                <div class="game-board" id="board">
                    <!-- سيتم إنشاء الخلايا ديناميكياً -->
                </div>
                
                <div class="controls">
                    <button id="restart">لعبة جديدة</button>
                    <button id="reset">إعادة التعيين</button>
                    <button id="backToSetup">العودة للإعدادات</button>
                </div>
            </div>
        </div>
        
        <!-- البنر الأيمن للإعلانات -->
        <div class="ad-container">
            <div class="ad-banner">
                <h3>إعلان</h3>
                <!-- إعلان جوجل أدسنس - بنر عمودي -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <div class="ad-note">إعلان - دعماً للموقع</div>
            </div>
            <div class="ad-banner">
                <h3>إعلان</h3>
                <!-- إعلان جوجل أدسنس - بنر مربع -->
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <div class="ad-note">إعلان - دعماً للموقع</div>
            </div>
        </div>
    </div>

    <!-- إعلان في أسفل الصفحة -->
    <div style="margin-top: 20px; width: 100%; max-width: 728px;">
        <!-- إعلان جوجل أدسنس - بنر أفقي -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="XXXXXXXXXX"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        <div style="text-align: center; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6); margin-top: 5px;">إعلان - دعماً للموقع</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // عناصر DOM
            const setupScreen = document.getElementById('setupScreen');
            const gameScreen = document.getElementById('gameScreen');
            const boardElement = document.getElementById('board');
            const statusDisplay = document.getElementById('status');
            const restartButton = document.getElementById('restart');
            const resetButton = document.getElementById('reset');
            const backToSetupButton = document.getElementById('backToSetup');
            const startButton = document.getElementById('startBtn');
            const playerXInput = document.getElementById('playerX');
            const playerOInput = document.getElementById('playerO');
            const boardSizeSelect = document.getElementById('boardSize');
            const playerXNameDisplay = document.getElementById('playerXName');
            const playerONameDisplay = document.getElementById('playerOName');
            const scoreX = document.getElementById('scoreX');
            const scoreO = document.getElementById('scoreO');
            const scoreTie = document.getElementById('scoreTie');
            
            // متغيرات اللعبة
            let gameActive = true;
            let currentPlayer = 'X';
            let gameState = [];
            let boardSize = 3;
            let playerNames = {
                X: 'لاعب X',
                O: 'لاعب O'
            };
            let scores = {
                X: 0,
                O: 0,
                tie: 0
            };
            let cells = [];
            
            // رسائل الحالة
            const winningMessage = () => `فاز ${playerNames[currentPlayer]}!`;
            const drawMessage = () => `تعادل!`;
            const currentPlayerTurn = () => `دور: ${playerNames[currentPlayer]}`;
            
            // بدء اللعبة
            startButton.addEventListener('click', startGame);
            
            // العودة إلى شاشة الإعدادات
            backToSetupButton.addEventListener('click', () => {
                gameScreen.style.display = 'none';
                setupScreen.style.display = 'block';
            });
            
            function startGame() {
                // الحصول على أسماء اللاعبين وحجم اللوحة
                playerNames.X = playerXInput.value || 'لاعب X';
                playerNames.O = playerOInput.value || 'لاعب O';
                boardSize = parseInt(boardSizeSelect.value);
                
                // تحديث عرض الأسماء
                playerXNameDisplay.textContent = playerNames.X;
                playerONameDisplay.textContent = playerNames.O;
                
                // تهيئة اللعبة
                initializeGame();
                
                // الانتقال إلى شاشة اللعبة
                setupScreen.style.display = 'none';
                gameScreen.style.display = 'block';
            }
            
            function initializeGame() {
                // إعادة تعيين حالة اللعبة
                gameActive = true;
                currentPlayer = 'X';
                gameState = Array(boardSize * boardSize).fill('');
                
                // تحديث حالة اللعبة
                statusDisplay.innerHTML = currentPlayerTurn();
                
                // إنشاء لوحة اللعب
                createBoard();
                
                // إعادة تعيين النتائج إذا لزم الأمر
                updateScores();
            }
            
            function createBoard() {
                // مسح اللوحة الحالية
                boardElement.innerHTML = '';
                cells = [];
                
                // تعيين نمط الشبكة بناءً على حجم اللوحة
                boardElement.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
                boardElement.style.maxWidth = `${boardSize * 80}px`;
                
                // إنشاء الخلايا
                for (let i = 0; i < boardSize * boardSize; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.setAttribute('data-index', i);
                    cell.addEventListener('click', handleCellClick);
                    boardElement.appendChild(cell);
                    cells.push(cell);
                }
            }
            
            // معالجة نقرات الخلايا
            function handleCellClick(clickedCellEvent) {
                const clickedCell = clickedCellEvent.target;
                const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));
                
                // التحقق من أن الخلية لم تُلعب مسبقًا وأن اللعبة نشطة
                if (gameState[clickedCellIndex] !== '' || !gameActive) {
                    return;
                }
                
                // تحديث حالة اللعبة والخلايا
                gameState[clickedCellIndex] = currentPlayer;
                clickedCell.innerHTML = currentPlayer;
                clickedCell.classList.add(currentPlayer.toLowerCase());
                
                // التحقق من وجود فائز
                checkResult();
            }
            
            // التحقق من نتيجة اللعبة
            function checkResult() {
                // عدد الخلايا المطلوبة للفوز (نفس عدد الصفوف)
                const winLength = boardSize;
                let roundWon = false;
                let winningCombo = [];
                let winType = '';
                
                // التحقق من الصفوف
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col <= boardSize - winLength; col++) {
                        let isWin = true;
                        let combo = [];
                        
                        for (let i = 0; i < winLength; i++) {
                            const index = row * boardSize + col + i;
                            if (gameState[index] !== currentPlayer) {
                                isWin = false;
                                break;
                            }
                            combo.push(index);
                        }
                        
                        if (isWin) {
                            roundWon = true;
                            winningCombo = combo;
                            winType = 'row';
                            break;
                        }
                    }
                    if (roundWon) break;
                }
                
                // التحقق من الأعمدة
                if (!roundWon) {
                    for (let col = 0; col < boardSize; col++) {
                        for (let row = 0; row <= boardSize - winLength; row++) {
                            let isWin = true;
                            let combo = [];
                            
                            for (let i = 0; i < winLength; i++) {
                                const index = (row + i) * boardSize + col;
                                if (gameState[index] !== currentPlayer) {
                                    isWin = false;
                                    break;
                                }
                                combo.push(index);
                            }
                            
                            if (isWin) {
                                roundWon = true;
                                winningCombo = combo;
                                winType = 'column';
                                break;
                            }
                        }
                        if (roundWon) break;
                    }
                }
                
                // التحقق من الأقطار (الرئيسية)
                if (!roundWon) {
                    for (let row = 0; row <= boardSize - winLength; row++) {
                        for (let col = 0; col <= boardSize - winLength; col++) {
                            let isWin = true;
                            let combo = [];
                            
                            for (let i = 0; i < winLength; i++) {
                                const index = (row + i) * boardSize + (col + i);
                                if (gameState[index] !== currentPlayer) {
                                    isWin = false;
                                    break;
                                }
                                combo.push(index);
                            }
                            
                            if (isWin) {
                                roundWon = true;
                                winningCombo = combo;
                                winType = 'diagonal';
                                break;
                            }
                        }
                        if (roundWon) break;
                    }
                }
                
                // التحقق من الأقطار (الثانوية)
                if (!roundWon) {
                    for (let row = 0; row <= boardSize - winLength; row++) {
                        for (let col = winLength - 1; col < boardSize; col++) {
                            let isWin = true;
                            let combo = [];
                            
                            for (let i = 0; i < winLength; i++) {
                                const index = (row + i) * boardSize + (col - i);
                                if (gameState[index] !== currentPlayer) {
                                    isWin = false;
                                    break;
                                }
                                combo.push(index);
                            }
                            
                            if (isWin) {
                                roundWon = true;
                                winningCombo = combo;
                                winType = 'diagonal';
                                break;
                            }
                        }
                        if (roundWon) break;
                    }
                }
                
                if (roundWon) {
                    // إضافة تأثيرات الفوز للخلايا
                    winningCombo.forEach(index => {
                        const cell = document.querySelector(`[data-index="${index}"]`);
                        cell.classList.add('winner-cell');
                    });
                    
                    // رسم خط الفوز
                    drawWinLine(winningCombo, winType);
                    
                    // عرض رسالة الفوز المتحركة
                    statusDisplay.innerHTML = `<div class="win-message">${winningMessage()}</div>`;
                    gameActive = false;
                    
                    // تشغيل تأثيرات الفوز
                    playWinSound();
                    createConfetti();
                    
                    // تحديث النتيجة
                    scores[currentPlayer]++;
                    updateScores();
                    return;
                }
                
                // التحقق من التعادل
                const roundDraw = !gameState.includes('');
                if (roundDraw) {
                    statusDisplay.innerHTML = drawMessage();
                    gameActive = false;
                    
                    // تشغيل صوت التعادل
                    playDrawSound();
                    
                    // تحديث النتيجة
                    scores.tie++;
                    updateScores();
                    return;
                }
                
                // تغيير اللاعب
                changePlayer();
            }
            
            // رسم خط الفوز المتحرك
            function drawWinLine(winningCombo, winType) {
                const winLine = document.createElement('div');
                winLine.className = 'win-line';
                
                // الحصول على موضع وحجم أول خلية في مجموعة الفوز
                const firstCell = document.querySelector(`[data-index="${winningCombo[0]}"]`);
                const cellRect = firstCell.getBoundingClientRect();
                const boardRect = boardElement.getBoundingClientRect();
                
                // تحديد موقع الخط بناءً على نوع الفوز
                if (winType === 'row') {
                    // خط أفقي للصفوف
                    winLine.style.width = '100%';
                    winLine.style.height = '8px';
                    winLine.style.top = `calc(${cellRect.top - boardRect.top + cellRect.height/2}px - 4px)`;
                    winLine.style.left = '0';
                } else if (winType === 'column') {
                    // خط عمودي للأعمدة
                    winLine.style.width = '8px';
                    winLine.style.height = '100%';
                    winLine.style.left = `calc(${cellRect.left - boardRect.left + cellRect.width/2}px - 4px)`;
                    winLine.style.top = '0';
                } else if (winType === 'diagonal') {
                    // خط قطري
                    const firstCellIndex = winningCombo[0];
                    const lastCellIndex = winningCombo[winningCombo.length - 1];
                    
                    // تحديد إذا كان قطر رئيسي أو ثانوي
                    if (lastCellIndex > firstCellIndex) {
                        // القطر الرئيسي من الأعلى اليسار إلى الأسفل اليمين
                        winLine.style.width = '140%';
                        winLine.style.height = '8px';
                        winLine.style.top = '50%';
                        winLine.style.left = '-20%';
                        winLine.style.transform = 'rotate(45deg)';
                    } else {
                        // القطر الثانوي من الأعلى اليمين إلى الأسفل اليسار
                        winLine.style.width = '140%';
                        winLine.style.height = '8px';
                        winLine.style.top = '50%';
                        winLine.style.left = '-20%';
                        winLine.style.transform = 'rotate(-45deg)';
                    }
                }
                
                boardElement.appendChild(winLine);
            }
            
            // تغيير اللاعب
            function changePlayer() {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                statusDisplay.innerHTML = currentPlayerTurn();
            }
            
            // تحديث النتائج
            function updateScores() {
                scoreX.textContent = scores.X;
                scoreO.textContent = scores.O;
                scoreTie.textContent = scores.tie;
            }
            
            // إعادة تشغيل اللعبة
            function restartGame() {
                gameActive = true;
                currentPlayer = 'X';
                gameState = Array(boardSize * boardSize).fill('');
                statusDisplay.innerHTML = currentPlayerTurn();
                
                cells.forEach(cell => {
                    cell.innerHTML = '';
                    cell.classList.remove('x', 'o', 'winner-cell');
                });
                
                // إزالة خط الفوز والكونفيتي
                document.querySelectorAll('.win-line').forEach(line => {
                    line.remove();
                });
                
                document.querySelectorAll('.confetti').forEach(confetti => {
                    confetti.remove();
                });
            }
            
            // إعادة تعيين النتائج
            function resetGame() {
                scores = { X: 0, O: 0, tie: 0 };
                updateScores();
                restartGame();
            }
            
            // تأثير الكونفيتي عند الفوز
            function createConfetti() {
                const colors = ['#ff4757', '#2ed573', '#1e90ff', '#ffa502', '#ff6b81', '#7bed9f', '#70a1ff', '#ff6348'];
                const confettiCount = 150;
                
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    
                    // حركة الكونفيتي
                    const animation = confetti.animate([
                        { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                        { transform: `translate(${Math.random() * 100 - 50}px, ${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                    });
                    
                    // إزالة الكونفيتي بعد انتهاء الحركة
                    animation.onfinish = () => {
                        confetti.remove();
                    };
                }
            }
            
            // مؤثرات صوتية
            function playWinSound() {
                // إنشاء صوت الفوز باستخدام Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }
            
            function playDrawSound() {
                // إنشاء صوت التعادل
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); // G4
                oscillator.frequency.setValueAtTime(349.23, audioContext.currentTime + 0.2); // F4
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            }
            
            // إضافة مستمعي الأحداث
            restartButton.addEventListener('click', restartGame);
            resetButton.addEventListener('click', resetGame);
        });
    </script>
</body>
</html>